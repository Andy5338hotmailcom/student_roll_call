<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>名单管理器 - 学生点名程序</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/css/font-awesome.min.css" rel="stylesheet">
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6C63FF',
                        secondary: '#F59E0B',
                        light: '#F3F4F6',
                        dark: '#1F2937'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.25);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .file-drop-area {
                border: 2px dashed #CBD5E0;
                transition: all 0.3s ease;
            }
            .file-drop-area.active {
                border-color: #6C63FF;
                background-color: rgba(108, 99, 255, 0.05);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-100 to-purple-200 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 顶部导航 -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-primary mb-1 text-shadow">名单管理器</h1>
                <p class="text-gray-600">管理点名程序的学生名单文件，欢迎使用！</p>
            </div>
            <div>
                <a href="index.html" class="inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700 transition-colors">
                    <i class="fa fa-arrow-left mr-2"></i>返回点名程序
                </a>
            </div>
        </header>

        <!-- 主要内容区 -->
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- 左侧文件列表 -->
            <div class="lg:w-1/3 bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-primary flex items-center">
                        <i class="fa fa-folder-open mr-2"></i>名单列表
                    </h2>
                    <div class="space-x-2">
                        <button id="refresh-files" class="p-2 text-gray-500 hover:text-primary transition-colors" title="刷新">
                            <i class="fa fa-refresh"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 文件操作按钮 -->
                <div class="mb-4">
                    <button id="new-file" class="w-full flex items-center justify-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700 transition-colors">
                        <i class="fa fa-plus-circle mr-2"></i>新建名单
                    </button>
                </div>

                <!-- 文件搜索 -->
                <div class="relative mb-4">
                    <input type="text" id="file-search" placeholder="搜索文件..." 
                           class="w-full pl-10 pr-4 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>

                <!-- 文件列表 -->
                <div class="space-y-2 max-h-[calc(100vh-240px)] overflow-y-auto pr-2" id="file-list">
                    <!-- 文件列表将通过JavaScript动态生成 -->
                    <div class="animate-pulse">
                        <div class="h-10 bg-purple-100 rounded animate-pulse"></div>
                        <div class="h-10 bg-purple-100 rounded animate-pulse mt-3"></div>
                        <div class="h-10 bg-purple-100 rounded animate-pulse mt-3"></div>
                    </div>
                </div>

                <!-- 文件上传区域 -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold text-primary mb-3 flex items-center">
                        <i class="fa fa-upload mr-2"></i>上传文件
                    </h3>
                    <div id="file-drop-area" class="file-drop-area rounded-lg p-6 text-center cursor-pointer">
                        <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-2"></i>
                        <p class="text-gray-500 mb-1">拖拽文件到此处或点击上传</p>
                        <p class="text-xs text-gray-400">支持 .txt 格式文件</p>
                        <input type="file" id="file-input" class="hidden" accept=".txt">
                    </div>
                </div>
            </div>

            <!-- 右侧文件内容区 -->
            <div class="lg:w-2/3 bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-primary flex items-center">
                        <i class="fa fa-file-text mr-2"></i><span id="current-file-name">未选择名单</span>
                    </h2>
                    <div class="space-x-2" id="file-actions">
                        <button id="edit-file" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-pencil mr-1"></i>编辑
                        </button>
                        <button id="delete-file" class="px-3 py-1 text-sm text-white bg-red-500 rounded hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-trash mr-1"></i>删除
                        </button>
                    </div>
                </div>

                <!-- 文件信息 -->
                <div class="bg-purple-50 rounded-lg p-3 mb-4 text-sm text-gray-600" id="file-info">
                    <span id="file-size">--</span> | 
                    <span id="file-modified">--</span> | 
                    <span id="line-count">--</span>
                </div>

                <!-- 文件内容显示/编辑区 -->
                <div class="mb-4">
                    <div id="file-content-view" class="bg-gray-50 rounded-lg p-4 min-h-[300px] whitespace-pre-wrap break-words font-mono text-sm text-gray-800">
                        <p class="text-gray-500 text-center italic">请从左侧选择一个名单</p>
                    </div>
                    <textarea id="file-content-edit" class="w-full bg-gray-50 rounded-lg p-4 min-h-[300px] font-mono text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-primary hidden" placeholder="在此输入文件内容..."></textarea>
                </div>

                <!-- 编辑操作按钮 -->
                <div class="flex justify-end space-x-3" id="edit-actions" style="display: none;">
                    <button id="cancel-edit" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors">
                        取消
                    </button>
                    <button id="save-file" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700 transition-colors">
                        保存
                    </button>
                </div>
            </div>
        </div>

        <!-- 底部信息 -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>名单管理器。郭宸好制作，欢迎使用！</p>
        </footer>
    </div>

    <!-- 模态框 - 新建文件 -->
    <div id="new-file-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">新建文件</h3>
            <div class="mb-4">
                <label for="new-file-name" class="block text-gray-700 mb-1">文件名</label>
                <div class="flex">
                    <input type="text" id="new-file-name" placeholder="输入文件名" 
                           class="flex-1 px-4 py-2 border border-purple-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    <span class="px-4 py-2 bg-gray-100 border border-l-0 border-purple-300 rounded-r-lg text-gray-600">.txt</span>
                </div>
            </div>
            <div class="mb-6">
                <label for="new-file-content" class="block text-gray-700 mb-1">文件内容</label>
                <textarea id="new-file-content" rows="5" placeholder="输入文件内容，每行一个学生姓名" 
                          class="w-full px-4 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
            </div>
            <div class="flex justify-end gap-3">
                <button id="cancel-new-file" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    取消
                </button>
                <button id="create-file" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700 transition-colors">
                    创建
                </button>
            </div>
        </div>
    </div>

    <!-- 模态框 - 删除确认 -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">确认删除</h3>
            <p class="text-gray-600 mb-6">确定要删除文件 <span id="delete-file-name" class="font-semibold"></span> 吗？此操作无法撤销。</p>
            <div class="flex justify-end gap-3">
                <button id="cancel-delete" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    取消
                </button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                    确认删除
                </button>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center">
        <i id="notification-icon" class="fa mr-2"></i>
        <span id="notification-message"></span>
    </div>

    <script>
        // 全局变量
        let files = [];
        let currentFile = null;
        let isEditing = false;

        // DOM 元素
        const fileList = document.getElementById('file-list');
        const fileDropArea = document.getElementById('file-drop-area');
        const fileInput = document.getElementById('file-input');
        const fileSearch = document.getElementById('file-search');
        const currentFileName = document.getElementById('current-file-name');
        const fileSize = document.getElementById('file-size');
        const fileModified = document.getElementById('file-modified');
        const lineCount = document.getElementById('line-count');
        const fileContentView = document.getElementById('file-content-view');
        const fileContentEdit = document.getElementById('file-content-edit');
        const editFileBtn = document.getElementById('edit-file');
        const deleteFileBtn = document.getElementById('delete-file');
        const editActions = document.getElementById('edit-actions');
        const cancelEditBtn = document.getElementById('cancel-edit');
        const saveFileBtn = document.getElementById('save-file');
        const refreshFilesBtn = document.getElementById('refresh-files');
        const newFileBtn = document.getElementById('new-file');
        const newFileModal = document.getElementById('new-file-modal');
        const cancelNewFileBtn = document.getElementById('cancel-new-file');
        const createFileBtn = document.getElementById('create-file');
        const newFileNameInput = document.getElementById('new-file-name');
        const newFileContentInput = document.getElementById('new-file-content');
        const deleteModal = document.getElementById('delete-modal');
        const cancelDeleteBtn = document.getElementById('cancel-delete');
        const confirmDeleteBtn = document.getElementById('confirm-delete');
        const deleteFileName = document.getElementById('delete-file-name');
        const notification = document.getElementById('notification');
        const notificationIcon = document.getElementById('notification-icon');
        const notificationMessage = document.getElementById('notification-message');

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            initialize();
            setupEventListeners();
        });

        // 初始化
        function initialize() {
            // 从localStorage加载文件
            loadFiles();
            
            // 初始化文件列表
            renderFileList();
            
            // 禁用文件操作按钮
            updateFileActionButtons(false);
        }

        // 从localStorage加载文件
        function loadFiles() {
            const storedFiles = localStorage.getItem('rollCallFiles');
            
            if (storedFiles) {
                files = JSON.parse(storedFiles);
            } else {
                // 初始化示例文件
                const exampleFiles = [
                    {
                        id: 'cs',
                        name: '学号（40）.txt',
                        size: 42,
                        lastModified: Date.now(),
                        content: '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40'
                    },
                    {
                        id: 'literature',
                        name: '学号（47）.txt',
                        size: 42,
                        lastModified: Date.now(),
                        content: '1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47'
                    }
                ];
                
                files = exampleFiles;
                saveFilesToStorage();
            }
        }

        // 保存文件到localStorage
        function saveFilesToStorage() {
            localStorage.setItem('rollCallFiles', JSON.stringify(files));
        }

        // 渲染文件列表
        function renderFileList() {
            const searchTerm = fileSearch.value.toLowerCase();
            const filteredFiles = files.filter(file => 
                file.name.toLowerCase().includes(searchTerm)
            );
            
            fileList.innerHTML = '';
            
            if (filteredFiles.length === 0) {
                fileList.innerHTML = '<p class="text-gray-500 text-center italic py-4">没有找到文件</p>';
                return;
            }
            
            filteredFiles.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = `flex items-center justify-between p-2 rounded-lg cursor-pointer transition-colors ${currentFile && currentFile.id === file.id ? 'bg-primary bg-opacity-10 text-primary' : 'hover:bg-gray-100'}`;
                fileItem.dataset.fileId = file.id;
                
                fileItem.innerHTML = `
                    <div class="flex items-center">
                        <i class="fa fa-file-text-o text-primary mr-2"></i>
                        <div class="truncate">
                            <div class="font-medium">${file.name}</div>
                            <div class="text-xs text-gray-500">${formatFileSize(file.size)} · ${formatDateTime(file.lastModified)}</div>
                        </div>
                    </div>
                    <div class="space-x-1">
                        <button class="p-1 text-gray-400 hover:text-primary transition-colors view-file" title="查看">
                            <i class="fa fa-eye"></i>
                        </button>
                        <button class="p-1 text-gray-400 hover:text-primary transition-colors edit-file" title="编辑">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button class="p-1 text-gray-400 hover:text-red-500 transition-colors delete-file" title="删除">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // 绑定事件
                fileItem.addEventListener('click', (e) => {
                    // 如果点击的是按钮，不执行文件选择
                    if (e.target.closest('button')) return;
                    selectFile(file.id);
                });
                
                // 查看文件按钮
                fileItem.querySelector('.view-file').addEventListener('click', () => {
                    selectFile(file.id);
                });
                
                // 编辑文件按钮
                fileItem.querySelector('.edit-file').addEventListener('click', () => {
                    selectFile(file.id);
                    startEditing();
                });
                
                // 删除文件按钮
                fileItem.querySelector('.delete-file').addEventListener('click', () => {
                    showDeleteConfirmation(file.id);
                });
                
                fileList.appendChild(fileItem);
            });
        }

        // 选择文件
        function selectFile(fileId) {
            const file = files.find(f => f.id === fileId);
            
            if (file) {
                currentFile = file;
                displayFileContent();
                updateFileActionButtons(true);
                renderFileList(); // 更新文件列表选中状态
            }
        }

        // 显示文件内容
        function displayFileContent() {
            if (!currentFile) return;
            
            currentFileName.textContent = currentFile.name;
            fileSize.textContent = `大小: ${formatFileSize(currentFile.size)}`;
            fileModified.textContent = `修改时间: ${formatDateTime(currentFile.lastModified)}`;
            
            const lines = currentFile.content.split('\n');
            lineCount.textContent = `行数: ${lines.length}`;
            
            // 显示文件内容
            fileContentView.textContent = currentFile.content;
            fileContentEdit.value = currentFile.content;
            
            // 切换到查看模式
            stopEditing();
        }

        // 开始编辑文件
        function startEditing() {
            if (!currentFile) return;
            
            isEditing = true;
            fileContentView.classList.add('hidden');
            fileContentEdit.classList.remove('hidden');
            editActions.style.display = 'flex';
            editFileBtn.disabled = true;
            
            // 聚焦到编辑框
            fileContentEdit.focus();
        }

        // 停止编辑文件
        function stopEditing() {
            isEditing = false;
            fileContentView.classList.remove('hidden');
            fileContentEdit.classList.add('hidden');
            editActions.style.display = 'none';
            
            if (currentFile) {
                editFileBtn.disabled = false;
            }
        }

        // 保存文件
        function saveFile() {
            if (!currentFile || !isEditing) return;
            
            const newContent = fileContentEdit.value;
            
            // 更新文件内容
            currentFile.content = newContent;
            currentFile.size = newContent.length;
            currentFile.lastModified = Date.now();
            
            // 保存到存储
            saveFilesToStorage();
            
            // 更新显示
            displayFileContent();
            
            // 显示通知
            showNotification('success', '文件已成功保存');
        }

        // 上传文件
        function uploadFile(file) {
            if (!file || !file.name.endsWith('.txt')) {
                showNotification('error', '请上传.txt格式的文件');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                
                // 创建新文件对象
                const newFile = {
                    id: generateUniqueId(),
                    name: file.name,
                    size: content.length,
                    lastModified: Date.now(),
                    content: content
                };
                
                // 添加到文件列表
                files.push(newFile);
                saveFilesToStorage();
                
                // 更新文件列表
                renderFileList();
                
                // 选择新上传的文件
                selectFile(newFile.id);
                
                // 显示通知
                showNotification('success', `文件 "${file.name}" 已成功上传`);
            };
            
            reader.onerror = function() {
                showNotification('error', '读取文件时发生错误');
            };
            
            reader.readAsText(file);
        }

        // 创建新文件
        function createNewFile() {
            const fileName = newFileNameInput.value.trim();
            
            if (!fileName) {
                showNotification('error', '请输入文件名');
                return;
            }
            
            // 确保文件名以.txt结尾
            const fullFileName = fileName.endsWith('.txt') ? fileName : `${fileName}.txt`;
            
            // 检查文件是否已存在
            const fileExists = files.some(file => file.name === fullFileName);
            
            if (fileExists) {
                showNotification('error', `文件 "${fullFileName}" 已存在`);
                return;
            }
            
            const content = newFileContentInput.value;
            
            // 创建新文件对象
            const newFile = {
                id: generateUniqueId(),
                name: fullFileName,
                size: content.length,
                lastModified: Date.now(),
                content: content
            };
            
            // 添加到文件列表
            files.push(newFile);
            saveFilesToStorage();
            
            // 更新文件列表
            renderFileList();
            
            // 选择新创建的文件
            selectFile(newFile.id);
            
            // 关闭模态框
            newFileModal.classList.add('hidden');
            
            // 清空输入
            newFileNameInput.value = '';
            newFileContentInput.value = '';
            
            // 显示通知
            showNotification('success', `文件 "${fullFileName}" 已成功创建`);
        }

        // 删除文件
        function deleteFile(fileId) {
            const index = files.findIndex(file => file.id === fileId);
            
            if (index !== -1) {
                const deletedFile = files.splice(index, 1)[0];
                
                // 如果删除的是当前选中的文件
                if (currentFile && currentFile.id === fileId) {
                    currentFile = null;
                    currentFileName.textContent = '未选择文件';
                    fileSize.textContent = '--';
                    fileModified.textContent = '--';
                    lineCount.textContent = '--';
                    fileContentView.innerHTML = '<p class="text-gray-500 text-center italic">请从左侧选择一个文件</p>';
                    updateFileActionButtons(false);
                }
                
                // 保存到存储
                saveFilesToStorage();
                
                // 更新文件列表
                renderFileList();
                
                // 显示通知
                showNotification('success', `文件 "${deletedFile.name}" 已成功删除`);
            }
        }

        // 显示删除确认对话框
        function showDeleteConfirmation(fileId) {
            const file = files.find(f => f.id === fileId);
            
            if (file) {
                deleteFileName.textContent = file.name;
                deleteModal.classList.remove('hidden');
                
                // 绑定确认删除事件
                confirmDeleteBtn.onclick = function() {
                    deleteFile(fileId);
                    deleteModal.classList.add('hidden');
                };
            }
        }

        // 更新文件操作按钮状态
        function updateFileActionButtons(enabled) {
            editFileBtn.disabled = !enabled;
            deleteFileBtn.disabled = !enabled;
        }

        // 显示通知
        function showNotification(type, message) {
            // 设置通知类型
            if (type === 'success') {
                notification.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-green-500 text-white transform translate-y-0 opacity-100 transition-all duration-300 z-50 flex items-center';
                notificationIcon.className = 'fa fa-check-circle mr-2';
            } else if (type === 'error') {
                notification.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-red-500 text-white transform translate-y-0 opacity-100 transition-all duration-300 z-50 flex items-center';
                notificationIcon.className = 'fa fa-exclamation-circle mr-2';
            } else if (type === 'info') {
                notification.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-blue-500 text-white transform translate-y-0 opacity-100 transition-all duration-300 z-50 flex items-center';
                notificationIcon.className = 'fa fa-info-circle mr-2';
            }
            
            // 设置通知消息
            notificationMessage.textContent = message;
            
            // 显示通知
            notification.style.display = 'flex';
            
            // 3秒后隐藏通知
            setTimeout(() => {
                notification.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center';
            }, 3000);
        }

        // 生成唯一ID
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
            else return (bytes / 1048576).toFixed(2) + ' MB';
        }

        // 格式化日期时间
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString();
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 文件拖放区域
            fileDropArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDropArea.classList.add('active');
            });
            
            fileDropArea.addEventListener('dragleave', () => {
                fileDropArea.classList.remove('active');
            });
            
            fileDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropArea.classList.remove('active');
                
                if (e.dataTransfer.files.length > 0) {
                    uploadFile(e.dataTransfer.files[0]);
                }
            });
            
            // 文件输入
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    uploadFile(fileInput.files[0]);
                }
            });
            
            // 文件搜索
            fileSearch.addEventListener('input', renderFileList);
            
            // 文件操作按钮
            editFileBtn.addEventListener('click', startEditing);
            deleteFileBtn.addEventListener('click', () => {
                if (currentFile) {
                    showDeleteConfirmation(currentFile.id);
                }
            });
            
            // 编辑操作按钮
            cancelEditBtn.addEventListener('click', stopEditing);
            saveFileBtn.addEventListener('click', saveFile);
            
            // 刷新文件列表
            refreshFilesBtn.addEventListener('click', () => {
                loadFiles();
                renderFileList();
                showNotification('info', '文件列表已刷新');
            });
            
            // 新建文件
            newFileBtn.addEventListener('click', () => {
                newFileModal.classList.remove('hidden');
            });
            
            cancelNewFileBtn.addEventListener('click', () => {
                newFileModal.classList.add('hidden');
            });
            
            createFileBtn.addEventListener('click', createNewFile);
            
            // 删除确认
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.classList.add('hidden');
            });
            
            // 点击模态框背景关闭
            newFileModal.addEventListener('click', (e) => {
                if (e.target === newFileModal) {
                    newFileModal.classList.add('hidden');
                }
            });
            
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) {
                    deleteModal.classList.add('hidden');
                }
            });
            
            // 键盘快捷键
            document.addEventListener('keydown', (e) => {
                // Ctrl+S 保存文件
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    if (isEditing) {
                        saveFile();
                    }
                }
                
                // Esc 关闭模态框或取消编辑
                if (e.key === 'Escape') {
                    if (!newFileModal.classList.contains('hidden')) {
                        newFileModal.classList.add('hidden');
                    } else if (!deleteModal.classList.contains('hidden')) {
                        deleteModal.classList.add('hidden');
                    } else if (isEditing) {
                        stopEditing();
                    }
                }
            });
        }
    </script>
</body>
</html>
